
| Issue Type | Root Cause | API Error / Consequence |
| :--- | :--- | :--- |
| **'default' not permitted** | A field in the Pydantic model has a default value (e.g., `my_field: str = "default"`). | `'default' is not permitted within a property definition` |
| **'oneOf' not permitted** | The model contains a `List` of a `Union` type (especially with a `Discriminator`), generating a `oneOf` in the JSON schema. | `'oneOf' is not permitted within the items definition of an array property` |
| **'additionalProperties' issues** | Using a `Dict` type (or a model with a `dict` field) without explicitly forbidding additional properties. | `'additionalProperties' is required to be supplied and to be false` |
| **JSON Truncation** | Large outputs (e.g., from `WebSearchTool`) cause the model's response to be cut off mid-generation. | `Invalid JSON: EOF while parsing an object...` |

### üõ†Ô∏è Identified Problems and Workarounds

The core issue is that the JSON schema automatically generated by the SDK from your Pydantic model is sometimes incompatible with the stricter validation rules of the OpenAI API. Here are the details and potential solutions for each problem:

- **Problem: Default Values and Union Types**: The OpenAI API's schema validator explicitly forbids the `default` keyword and the use of `oneOf` within array `items` definitions. This becomes a problem when your Pydantic model uses these common features.
- **Solution**: As a temporary workaround, you might need to avoid using fields with default values and lists of union types in your `output_type` Pydantic models until the SDK is fixed. Alternatively, for complex schemas, you may have to fall back to prompt-based JSON generation and manual validation outside the `output_type` mechanism.

- **Problem: `additionalProperties` for `Dict` Types**: The OpenAI API requires that object schemas explicitly set `additionalProperties` to `false`. The automatic schema generation may not handle this correctly for `Dict` types or other loosely defined objects.
- **Solution**: If you are creating a `FunctionTool` manually, you can explicitly set `additionalProperties` to `false` in the generated JSON schema before passing it to the tool's `params_json_schema`.
  
    For `output_type` models, the best practice is to use explicitly defined Pydantic models instead of the generic `Dict` type to give the SDK a clear structure to work with.

- **Problem: Truncated JSON with Large Outputs**: There is a known issue where using tools like `WebSearchTool` alongside structured outputs can result in the model generating a valid API response, but the JSON content within it is cut off, leading to parsing failures.
- **Solution**: You can try setting `max_tokens` in the `ModelSettings` to a high value (e.g., 128,000) to ensure the model has enough space to complete the JSON output. Another approach is to instruct the model in your prompt to keep the output below a certain character limit (e.g., 5500 characters).


